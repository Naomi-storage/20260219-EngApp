<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Flashcard Master</title>
    <!-- ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ã®è¨­å®šï¼ˆçµµæ–‡å­—ã‚’ã‚¢ã‚¤ã‚³ãƒ³ã¨ã—ã¦ä½¿ç”¨ï¼‰ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --error-color: #e74c3c;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
        }

        * {
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #app-container {
            width: 95%;
            max-width: 450px;
            height: 90vh;
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        header {
            background: var(--primary-color);
            color: white;
            padding: 18px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            letter-spacing: 0.05em;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: #ecf0f1;
            padding: 8px;
            font-size: 0.85rem;
            border-bottom: 1px solid #ddd;
        }

        #game-screen {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 25px;
            justify-content: space-between;
            align-items: center;
        }

        .question-card {
            width: 100%;
            flex-grow: 1;
            margin-bottom: 20px;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 30px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        #japanese-text {
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        #english-text {
            color: var(--accent-color);
            font-size: 1.4rem;
            font-weight: bold;
            line-height: 1.4;
            display: none;
            word-wrap: break-word;
        }

        .controls {
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn {
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.95rem;
            cursor: pointer;
            color: white;
        }

        .btn-correct { background-color: var(--success-color); }
        .btn-wrong { background-color: var(--error-color); }
        .btn-finish { background-color: #bdc3c7; grid-column: span 2; margin-top: 5px; color: #2c3e50; }

        #start-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--primary-color);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            padding: 20px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            width: 100%;
            margin-top: 20px;
        }

        .category-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            font-size: 0.9rem;
            cursor: pointer;
        }

        #result-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            text-align: center;
            z-index: 110;
        }

        .result-score { font-size: 4rem; color: var(--accent-color); font-weight: 800; margin: 10px 0; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="start-overlay">
        <h1 style="margin-bottom: 5px; font-size: 1.5rem;">English Advanced</h1>
        <p style="opacity: 0.8; margin-bottom: 20px; font-size: 0.9rem;">å­¦ç¿’ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„</p>
        <div class="category-grid">
            <button class="category-btn" onclick="startGame('business')">ğŸ’¼ è·å ´ã®åŒåƒšãƒ»ä¸Šå¸ã¨ã®ä¼šè©±</button>
            <button class="category-btn" onclick="startGame('meeting')">ğŸŒ Webä¼šè­°ã®ãƒ•ãƒ¬ãƒ¼ã‚º</button>
            <button class="category-btn" onclick="startGame('daily')">ğŸ  æ—¥å¸¸ç”Ÿæ´»ï¼ˆä¸­ä¸Šç´šï¼‰</button>
            <button class="category-btn" onclick="startGame('news')">ğŸ“ˆ æ™‚äº‹å•é¡Œãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰</button>
        </div>
    </div>

    <header id="current-category-name">English Master</header>
    
    <div class="stats-bar">
        <span>æœªå®Œäº†: <span id="stat-remaining">0</span></span>
        <span>æ­£è§£æ•°: <span id="stat-correct">0</span></span>
    </div>

    <div id="game-screen">
        <div class="question-card" id="card" onclick="showAnswer()">
            <div id="japanese-text">èª­ã¿è¾¼ã¿ä¸­...</div>
            <div id="english-text"></div>
        </div>

        <div class="controls" id="game-controls" style="visibility: hidden;">
            <button class="btn btn-correct" onclick="handleResult(true)">è¦šãˆãŸ</button>
            <button class="btn btn-wrong" onclick="handleResult(false)">ã¾ãŸå‡ºã™</button>
            <button class="btn btn-finish" onclick="finishGame()">çµ‚äº†</button>
        </div>
    </div>

    <div id="result-screen">
        <h2>Performance</h2>
        <div class="result-score" id="final-rate">0%</div>
        <p id="final-stats" style="color: #7f8c8d;"></p>
        <p id="feedback-msg" style="font-weight: bold; margin-top: 15px;"></p>
        <button class="btn" style="background: var(--primary-color); width: 100%; margin-top: 30px;" onclick="location.reload()">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
    </div>
</div>

<script>
    const questionBank = {
        business: [
            { jp: "ãŠå¿™ã—ã„ã¨ã“ã‚æç¸®ã§ã™ãŒã€é€²æ—ã‚’ä¼ºãˆã¾ã™ã‹ï¼Ÿ", en: "I'm sorry to bother you, but could you give me an update on the progress?" },
            { jp: "ãã®ä»¶ã«ã¤ãã¾ã—ã¦ã¯ã€æ”¹ã‚ã¦æ¤œè¨ã•ã›ã¦ãã ã•ã„ã€‚", en: "Please let me take that under advisement and get back to you." },
            { jp: "ã”æœŸå¾…ã«æ²¿ãˆãšã€å¤§å¤‰å¿ƒè‹¦ã—ãæ€ã£ã¦ãŠã‚Šã¾ã™ã€‚", en: "We deeply regret that we were unable to meet your expectations." },
            { jp: "æ—©æ€¥ã«ã“ã®å•é¡Œã«å¯¾å‡¦ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", en: "We need to address this issue as a matter of urgency." },
            { jp: "å½¼ã®ææ¡ˆã¯æ¤œè¨ã«å€¤ã™ã‚‹ã¨æ€ã„ã¾ã™ã€‚", en: "I believe his proposal is worthy of consideration." },
            { jp: "ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸»ãªç›®çš„ã¯ã€åŠ¹ç‡ã‚’æœ€å¤§åŒ–ã™ã‚‹ã“ã¨ã§ã™ã€‚", en: "The primary objective of this project is to maximize efficiency." },
            { jp: "å¿µã®ãŸã‚ç¢ºèªã§ã™ãŒã€ç· ã‚åˆ‡ã‚Šã¯æ¥é€±ã®æœˆæ›œã§ã™ã‚ˆã­ï¼Ÿ", en: "Just to be on the safe side, the deadline is next Monday, right?" },
            { jp: "ãã®ä»¶ã«ã¤ã„ã¦ã€éƒ¨é•·ã®æ‰¿èªã‚’å¾—ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚", en: "We need to obtain approval from the general manager regarding that matter." },
            { jp: "ä»Šã®ã¨ã“ã‚ã€ã™ã¹ã¦è¨ˆç”»é€šã‚Šã«é€²ã‚“ã§ã„ã¾ã™ã€‚", en: "So far, everything is proceeding according to plan." },
            { jp: "ã“ã‚Œã«ã¤ã„ã¦ã€ã‚ãªãŸã®ç‡ç›´ãªæ„è¦‹ã‚’èã‹ã›ã¦ãã ã•ã„ã€‚", en: "Please let me have your candid opinion on this." },
            { jp: "ã“ã®ä»¶ã¯ç§ã®æ–¹ã§å¼•ãå—ã‘ã¾ã™ã€‚", en: "I will take charge of this matter." },
            { jp: "ä¿®æ­£ç‚¹ã«ã¤ã„ã¦ã€è©³ã—ãèª¬æ˜ã—ã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ", en: "Could you elaborate on the points that need to be revised?" },
            { jp: "ã”ææ¡ˆã„ãŸã ã„ãŸä»¶ã€å‰å‘ãã«æ¤œè¨ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚", en: "We will give your proposal positive consideration." },
            { jp: "æœŸå¾…ä»¥ä¸Šã®æˆæœã‚’ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚", en: "We were able to achieve results that exceeded our expectations." },
            { jp: "ãã®è³ªå•ã«ã¤ã„ã¦ã¯ã€å¾Œã»ã©ãƒ¡ãƒ¼ãƒ«ã§å›ç­”ã„ãŸã—ã¾ã™ã€‚", en: "I will get back to you on that question via email later." },
            { jp: "ã‚³ã‚¹ãƒˆå‰Šæ¸›ã®ãŸã‚ã«ã€ãƒ—ãƒ­ã‚»ã‚¹ã®è¦‹ç›´ã—ãŒå¿…è¦ã§ã™ã€‚", en: "We need to review the process to reduce costs." },
            { jp: "ç«¶åˆä»–ç¤¾ã«å·®ã‚’ã¤ã‘ã‚‹ãŸã‚ã®æˆ¦ç•¥ã‚’ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚", en: "Let's devise a strategy to gain an edge over our competitors." },
            { jp: "ã“ã®ä»¶ã‚’å„ªå…ˆäº‹é …ã¨ã—ã¦æ‰±ã£ã¦ãã ã•ã„ã€‚", en: "Please treat this matter as a priority." },
            { jp: "ã‚ãªãŸã®å¤šå¤§ãªã‚‹è²¢çŒ®ã«æ„Ÿè¬ã„ãŸã—ã¾ã™ã€‚", en: "We appreciate your significant contribution." },
            { jp: "ãã‚Œã¯ç§ã®ä¸€å­˜ã§ã¯æ±ºã‚ã‚‰ã‚Œã‹ã­ã¾ã™ã€‚", en: "I'm afraid I cannot decide that on my own." }
        ],
        meeting: [
            { jp: "ç”»é¢ãŒå…±æœ‰ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ", en: "Could you confirm if my screen is being shared correctly?" },
            { jp: "æã‚Œå…¥ã‚Šã¾ã™ãŒã€å°‘ã—ãŠå£°ãŒé ã„ã‚ˆã†ã§ã™ã€‚", en: "I'm afraid your voice is a bit faint. Could you speak up?" },
            { jp: "è©±ã®é€”ä¸­ã§ã™ã¿ã¾ã›ã‚“ãŒã€ä¸€ç‚¹è³ªå•ã•ã›ã¦ãã ã•ã„ã€‚", en: "Sorry for interrupting, but may I ask a quick question?" },
            { jp: "é›»æ³¢ã®çŠ¶æ³ãŒæ‚ªãã€éŸ³å£°ãŒé€”åˆ‡ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚", en: "The connection was unstable and your audio cut out." },
            { jp: "æœ¬æ—¥ã®è­°äº‹éŒ²ã¯ã€çµ‚äº†å¾Œã«å…±æœ‰ã„ãŸã—ã¾ã™ã€‚", en: "I will circulate the minutes of today's meeting afterwards." },
            { jp: "çš†ã•ã‚“ã€ãŠæƒã„ã§ã—ã‚‡ã†ã‹ï¼Ÿå§‹ã‚ã¾ã—ã‚‡ã†ã€‚", en: "Is everyone here? Let's get started." },
            { jp: "ãƒã‚¤ã‚¯ã‚’ãƒŸãƒ¥ãƒ¼ãƒˆã«ã—ã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ", en: "Could you please mute your microphone?" },
            { jp: "æ¬¡ã®ã‚¢ã‚¸ã‚§ãƒ³ãƒ€ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚", en: "Let's move on to the next item on the agenda." },
            { jp: "ã‚‚ã†ä¸€åº¦ãŠã£ã—ã‚ƒã£ã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ", en: "Could you say that again, please?" },
            { jp: "ç”»é¢ãŒå›ºã¾ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚", en: "It seems your screen is frozen." },
            { jp: "ãƒãƒ£ãƒƒãƒˆæ¬„ã«ãƒªãƒ³ã‚¯ã‚’è²¼ã‚Šã¾ã—ãŸã€‚", en: "I've posted the link in the chat box." },
            { jp: "ãã®ä»¶ã¯æ¬¡å›ã®ä¼šè­°ã§è­°è«–ã—ã¾ã—ã‚‡ã†ã€‚", en: "Let's discuss that matter in the next meeting." },
            { jp: "æŒã¡å¸°ã£ã¦æ¤œè¨ã—ã€æ˜æ—¥ãŠè¿”äº‹ã—ã¾ã™ã€‚", en: "I'll take that back, look into it, and get back to you tomorrow." },
            { jp: "ã‚¹ãƒ©ã‚¤ãƒ‰ãŒè¦‹ãˆã¾ã™ã‹ï¼Ÿ", en: "Can you see the slides?" },
            { jp: "è¦ç‚¹ã‚’ã¾ã¨ã‚ã‚‹ã¨ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚", en: "To wrap up, the main points are as follows." }
        ],
        daily: [
            { jp: "é£¯ç”°æ©‹é§…ã‹ã‚‰æ±äº¬é§…ã¯ã€ã¾ãšç·æ­¦ç·šã«ä¹—ã‚Šã€ãŠèŒ¶ã®æ°´é§…ã§ä¸­å¤®ç·šã«ä¹—ã‚Šæ›ãˆã¾ã™ã€‚", en: "To get from Iidabashi to Tokyo Station, first take the Sobu Line and then transfer to the Chuo Line at Ochanomizu Station." },
            { jp: "ãƒãƒ³ã‚·ãƒ§ãƒ³ä¾¡æ ¼ã®é«˜é¨°ã«ã‚ˆã‚Šã€è³¼å…¥ã¯ã‚‚ã¡ã‚ã‚“è³ƒè²¸ä¾¡æ ¼ã‚‚ä¸Šæ˜‡ã—ã¦ã„ã¾ã™ã€‚ç‰¹ã«å­è‚²ã¦ä¸–å¸¯ã«ã¨ã£ã¦ã®å•é¡Œã¯ã€ãƒ•ã‚¡ãƒŸãƒªãƒ¼å‘ã‘ç‰©ä»¶ã®ä¾›çµ¦æ•°ãŒå°‘ãªã„ã“ã¨ã§ã™ã€‚", en: "Due to the soaring prices of apartments, not only purchase prices but also rental costs are on the rise. A particular problem for families with children is the limited supply of family-oriented properties." },
            { jp: "ã“ã®è·¯ç·šã®ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒ¯ãƒ¼ã¯éå¸¸ã«æ··é›‘ã—ã€ã—ã°ã—ã°é…å»¶ãŒç™ºç”Ÿã—ã¾ã™ã€‚", en: "The rush hour on this line is extremely crowded, and delays occur frequently." },
            { jp: "æœ€å¯„ã‚Šé§…ã¾ã§å¾’æ­©åœå†…ã§ã€å‘¨è¾ºã«ã¯ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚‚ã‚ã‚Šä¾¿åˆ©ã§ã™ã€‚", en: "It's within walking distance of the nearest station, and having supermarkets nearby makes it very convenient." },
            { jp: "æœ€è¿‘ã€é¦–éƒ½åœã®ä¸å‹•ç”£å¸‚å ´ã¯ãƒãƒ–ãƒ«ã®ã‚ˆã†ãªçŠ¶æ…‹ã ã¨è¨€ã‚ã‚Œã¦ã„ã¾ã™ã€‚", en: "It is often said that the real estate market in the metropolitan area has been in a bubble-like state recently." },
            { jp: "æœ€è¿‘ã€ä»•äº‹ã¨ç§ç”Ÿæ´»ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ã®ã«è‹¦åŠ´ã—ã¦ã„ã¾ã™ã€‚", en: "I've been struggling to strike a balance between work and my personal life lately." },
            { jp: "ãã‚Œã¯ç§ã«ã¨ã£ã¦ã€ã¨ã¦ã‚‚æ„Ÿæ…¨æ·±ã„å‡ºæ¥äº‹ã§ã—ãŸã€‚", en: "That was a very poignant and emotional experience for me." },
            { jp: "å½¼ã®æ±ºæ–­ã«ã¯ã€ã‚ã‚‹ç¨‹åº¦ã®å¦¥å”ãŒå¿…è¦ã§ã—ãŸã€‚", en: "His decision required a certain amount of compromise." },
            { jp: "ã“ã‚Œã¾ã§ã®åŠªåŠ›ãŒã‚ˆã†ã‚„ãå®Ÿã‚’çµã³ã¾ã—ãŸã€‚", en: "All the hard work has finally come to fruition." },
            { jp: "å¥åº·ã®ãŸã‚ã«é‡èœã‚’ãŸãã•ã‚“é£Ÿã¹ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚", en: "I make it a point to eat a lot of vegetables for my health." },
            { jp: "å½¼ã¯ã¨ã¦ã‚‚æ°—ã•ããªäººã§ã™ã€‚", en: "He is a very easygoing person." },
            { jp: "é€±æœ«ã¯ã‚†ã£ãã‚Šä¼‘ã‚€ã¤ã‚‚ã‚Šã§ã™ã€‚", en: "I intend to take it easy this weekend." }
        ],
        news: [
            { jp: "å…ˆæ—¥ã®è¡†è­°é™¢é¸æŒ™ã§å¤§å‹ã—ãŸé«˜å¸‚å†…é–£ã¯åœ§å€’çš„å¤šæ•°ã®ä¸å…šã¨ãªã‚Šã¾ã—ãŸã€‚", en: "The Takaichi Cabinet, which won a landslide victory in the recent lower house election, now commands an overwhelming majority as the ruling party." },
            { jp: "å„å›½ã§ã€ä¸–ä»£é–“ãƒ»å®—æ•™è¦³ã®åˆ†æ–­ãŒé€²ã‚“ã§ã„ã¾ã™ã€‚", en: "Divisions across generations and religious views are widening in many countries." },
            { jp: "ç¤¾ä¼šã®äºŒæ¥µåŒ–ã¯ã€æ°‘ä¸»ä¸»ç¾©ã®å®‰å®šã«å¯¾ã™ã‚‹é‡å¤§ãªè„…å¨ã¨ãªã£ã¦ã„ã¾ã™ã€‚", en: "The polarization of society has become a significant threat to the stability of democracy." },
            { jp: "æŒç¶šå¯èƒ½ãªç¤¾ä¼šã®å®Ÿç¾ã«å‘ã‘ã¦å–ã‚Šçµ„ã‚€ã¹ãã§ã™ã€‚", en: "We should strive towards achieving a sustainable society." },
            { jp: "ã‚¤ãƒ³ãƒ•ãƒ¬ãŒåŠ é€Ÿã—ã€æ¶ˆè²»è€…ã®è³¼è²·åŠ›ã«å½±éŸ¿ã‚’ä¸ãˆã¦ã„ã¾ã™ã€‚", en: "Accelerating inflation is affecting the purchasing power of consumers." },
            { jp: "AIã®æ€¥é€Ÿãªç™ºå±•ã¯ã€é›‡ç”¨å¸‚å ´ã‚’å†ç·¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚", en: "The rapid advancement of AI has the potential to reshape the job market." },
            { jp: "å¤šæ§˜æ€§ã¨åŒ…æ‘‚æ€§ã¯ã€ç¾ä»£ã®çµ„ç¹”ã«ãŠã„ã¦ä¸å¯æ¬ ã§ã™ã€‚", en: "Diversity and inclusion are essential in modern organizations." },
            { jp: "å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¸ã®è»¢æ›ãŒé€²ã‚“ã§ã„ã¾ã™ã€‚", en: "The shift towards renewable energy is gaining momentum." },
            { jp: "æœ€æ–°æŠ€è¡“ãŒåŒ»ç™‚ç¾å ´ã«å°å…¥ã•ã‚Œã¦ã„ã¾ã™ã€‚", en: "Cutting-edge technology is being introduced to the medical field." },
            { jp: "æ”¿åºœã¯æ–°ã—ã„çµŒæ¸ˆå¯¾ç­–ã‚’ç™ºè¡¨ã—ã¾ã—ãŸã€‚", en: "The government announced a new economic package." }
        ]
    };

    const categoryNames = {
        business: "ğŸ’¼ è·å ´ã§ã®ä¼šè©±",
        meeting: "ğŸŒ Webä¼šè­°",
        daily: "ğŸ  æ—¥å¸¸ç”Ÿæ´»",
        news: "ğŸ“ˆ æ™‚äº‹ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰"
    };

    let currentQueue = [];
    let currentQuestion = null;
    let totalAttempts = 0;
    let correctCount = 0;
    let audioEnabled = false;

    const japaneseEl = document.getElementById('japanese-text');
    const englishEl = document.getElementById('english-text');
    const controlsEl = document.getElementById('game-controls');
    const statRem = document.getElementById('stat-remaining');
    const statCor = document.getElementById('stat-correct');
    const categoryHeader = document.getElementById('current-category-name');
    const synth = window.speechSynthesis;

    function startGame(category) {
        document.getElementById('start-overlay').style.display = 'none';
        categoryHeader.innerText = categoryNames[category];
        audioEnabled = true;
        
        // ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
        currentQueue = [...questionBank[category]].sort(() => Math.random() - 0.5);
        totalAttempts = 0;
        correctCount = 0;
        
        nextQuestion();
    }

    function nextQuestion() {
        if (currentQueue.length === 0) {
            finishGame();
            return;
        }

        currentQuestion = currentQueue[0];
        japaneseEl.innerText = currentQuestion.jp;
        englishEl.innerText = currentQuestion.en;
        englishEl.style.display = 'none';
        controlsEl.style.visibility = 'hidden';
        
        updateStats();
    }

    function showAnswer() {
        if (!currentQuestion || englishEl.style.display === 'block') return;
        
        englishEl.style.display = 'block';
        controlsEl.style.visibility = 'visible';
        
        if (audioEnabled) {
            const utter = new SpeechSynthesisUtterance(currentQuestion.en);
            utter.lang = 'en-US';
            utter.rate = 0.85;
            synth.cancel();
            synth.speak(utter);
        }
    }

    function handleResult(isCorrect) {
        totalAttempts++;
        if (isCorrect) {
            correctCount++;
            currentQueue.shift();
        } else {
            const wrongItem = currentQueue.shift();
            currentQueue.push(wrongItem);
        }
        nextQuestion();
    }

    function updateStats() {
        statRem.innerText = currentQueue.length;
        statCor.innerText = correctCount;
    }

    function finishGame() {
        const resultScreen = document.getElementById('result-screen');
        resultScreen.style.display = 'flex';
        
        const rate = totalAttempts === 0 ? 0 : Math.round((correctCount / totalAttempts) * 100);
        document.getElementById('final-rate').innerText = rate + "%";
        document.getElementById('final-stats').innerText = `å›ç­”æ•°: ${totalAttempts} / æ­£è§£æ•°: ${correctCount}`;
        
        const feedback = document.getElementById('feedback-msg');
        if (rate >= 90) feedback.innerText = "å®Œç’§ã§ã™ï¼ã“ã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ã€‚";
        else if (rate >= 70) feedback.innerText = "ç´ æ™´ã‚‰ã—ã„ï¼ã‚ã¨å°‘ã—ã§ãƒã‚¹ã‚¿ãƒ¼ã§ã™ã€‚";
        else feedback.innerText = "ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚ä½•åº¦ã‚‚ç¹°ã‚Šè¿”ã—ã¦è¦šãˆã¾ã—ã‚‡ã†ã€‚";
    }
</script>
</body>
</html>

